---
import BaseLayout from '@layouts/BaseLayout.astro'
import NavBar from '@components/NavBar.astro'
import Footer from '@components/Footer.astro'
import PropertyGallery from '@components/PropertyGallery.astro'
import AmenityBadge from '@components/AmenityBadge.astro'
import StatChip from '@components/StatChip.astro'
import content from '@data/content.json'

const { slug } = Astro.params as { slug: string }
type Property = {
  slug: string
  title: string
  location: string
  price: string
  beds: number
  baths: number
  area: number
  image: string
  description?: string
  amenities?: string[]
  gallery?: string[]
}

const items = content.properties as Property[]
const property = items.find((p) => p.slug === slug)
export async function getStaticPaths() {
  const items = (content.properties ?? []) as Property[]
  return items.map((p) => ({ params: { slug: p.slug } }))
}
---
<BaseLayout title={property ? property.title : 'Property'}>
  <NavBar />
  {property ? (
    <section class="container py-10">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
        <div class="lg:col-span-2 space-y-6">
          <div class="card p-6">
            <div class="flex flex-wrap items-center justify-between gap-4">
              <div>
                <h1 class="font-display text-2xl sm:text-3xl">{property.title}</h1>
                <p class="text-sm text-muted">{property.location}</p>
              </div>
              <div class="text-right">
                <div class="text-xl font-semibold text-primary">{property.price}</div>
                <div class="mt-2 flex flex-wrap gap-2">
                  <StatChip label={`${property.beds} Beds`} />
                  <StatChip label={`${property.baths} Baths`} />
                  <StatChip label={`${property.area} mÂ²`} />
                </div>
              </div>
            </div>
          </div>

          <PropertyGallery images={property.gallery ?? [property.image]} />

          <div class="card p-6">
            <h2 class="font-display text-xl">Overview</h2>
            <p class="mt-2 text-muted">{property.description ?? 'No description available.'}</p>
          </div>

          {property.amenities && (
            <div class="card p-6">
              <h2 class="font-display text-xl">Key Features & Amenities</h2>
              <div class="mt-4 flex flex-wrap gap-2">
                {property.amenities.map((a) => (
                  <AmenityBadge label={a} />
                ))}
              </div>
            </div>
          )}
        </div>

        <aside class="space-y-6">
          <div class="card p-6">
            <h3 class="font-semibold">Schedule a Visit</h3>
            <form class="mt-4 grid grid-cols-1 gap-3">
              <input class="rounded-xl bg-bg border border-border px-4 py-3" placeholder="Full Name" />
              <input class="rounded-xl bg-bg border border-border px-4 py-3" placeholder="Email" />
              <input class="rounded-xl bg-bg border border-border px-4 py-3" placeholder="Phone" />
              <button type="button" class="btn-primary">Request Viewing</button>
            </form>
          </div>
          <div class="card p-6">
            <h3 class="font-semibold">Mortgage Estimator</h3>
            <div class="mt-3 text-sm text-muted">Basic example numbers for demo purposes.</div>
            <div class="mt-4 grid grid-cols-2 gap-3">
              <input class="rounded-xl bg-bg border border-border px-3 py-2" placeholder="Down Payment" />
              <input class="rounded-xl bg-bg border border-border px-3 py-2" placeholder="Rate %" />
              <input class="rounded-xl bg-bg border border-border px-3 py-2" placeholder="Years" />
              <button type="button" class="btn-ghost">Calculate</button>
            </div>
          </div>
        </aside>
      </div>
    </section>
    ) : null}
  {property ? (
    <section class="container pb-12 space-y-8">
      <div class="card p-6">
        <h2 class="font-display text-xl">Comprehensive Pricing Details</h2>
        <p class="mt-2 text-muted">Transparent breakdown to help you plan with confidence.</p>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
          <div class="rounded-lg bg-bg border border-border p-4">
            <div class="flex items-center justify-between"><span>Listing Price</span><span class="font-semibold">{property.price}</span></div>
            <div class="flex items-center justify-between mt-2"><span>Estimated Taxes</span><span class="font-semibold">$12,500</span></div>
            <div class="flex items-center justify-between mt-2"><span>HOA (Annual)</span><span class="font-semibold">$1,200</span></div>
          </div>
          <div class="rounded-lg bg-bg border border-border p-4">
            <div class="flex items-center justify-between"><span>Insurance (Annual)</span><span class="font-semibold">$2,400</span></div>
            <div class="flex items-center justify-between mt-2"><span>Closing Costs</span><span class="font-semibold">$8,800</span></div>
            <div class="flex items-center justify-between mt-2"><span>Maintenance</span><span class="font-semibold">$1,000</span></div>
          </div>
        </div>
        <div class="mt-6 rounded-xl border-t border-border pt-4 text-sm text-muted">The figures above are estimates and may vary based on location and circumstances.</div>
      </div>

      <div class="card p-6">
        <h2 class="font-display text-xl">Inquire About This Property</h2>
        <p class="mt-2 text-muted">Fill out the form and our team will contact you with details and to schedule a viewing.</p>
        <form class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
          <input class="rounded-xl bg-bg border border-border px-4 py-3" placeholder="Full Name" />
          <input class="rounded-xl bg-bg border border-border px-4 py-3" placeholder="Email" />
          <input class="rounded-xl bg-bg border border-border px-4 py-3" placeholder="Phone" />
          <input class="rounded-xl bg-bg border border-border px-4 py-3" placeholder="Preferred Date" />
          <textarea class="md:col-span-2 rounded-xl bg-bg border border-border px-4 py-3" rows="6" placeholder="Message"></textarea>
          <div class="md:col-span-2 flex items-center justify-between">
            <label class="flex items-center gap-2 text-sm text-muted">
              <input type="checkbox" class="rounded border-border bg-bg" />
              I agree to be contacted
            </label>
            <button type="button" class="btn-primary">Submit Inquiry</button>
          </div>
        </form>
      </div>
    </section>
  ) : (
    <section class="container py-16">
      <div class="card p-6">
        <h1 class="font-display text-2xl">Property not found</h1>
        <p class="mt-2 text-muted">The listing you are looking for does not exist.</p>
      </div>
    </section>
  )}
  <Footer />
</BaseLayout>
